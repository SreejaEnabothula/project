<template>
  <lightning-card title="Order Product Basket" icon-name="standard:orders">

    <!-- Standalone use: enter an Order Id -->
    <template if:false={recordId}>
      <div class="slds-p-horizontal_medium slds-p-top_medium slds-grid slds-gutters">
        <div class="slds-col slds-size_2-of-3">
          <lightning-input
            label="Order Id"
            value={orderIdInput}
            placeholder="e.g., 801xxxxxxxxxxxx"
            onchange={handleOrderIdChange}>
          </lightning-input>
        </div>
        <div class="slds-col slds-size_1-of-3 slds-p-top_large">
          <lightning-button
            variant="brand"
            label="Load Basket"
            onclick={handleLoad}>
          </lightning-button>
        </div>
      </div>
    </template>

    <div class="slds-p-horizontal_medium slds-p-vertical_small">
      <lightning-datatable
        key-field="id"
        data={rows}
        columns={columns}
        draft-values={draftValues}
        hide-checkbox-column
        show-row-number-column
        is-loading={loading}
        oncellchange={handleCellChange}
        onsave={handleSave}>
      </lightning-datatable>

      <template if:true={hasRows}>
        <div class="slds-m-top_small slds-grid slds-grid_align-spread slds-align-middle">
          <div class="slds-text-title_caps">
            <span class="slds-m-right_x-small">Basket Total:</span>
            <lightning-formatted-number value={basketTotal} format-style="currency"></lightning-formatted-number>
          </div>
          <lightning-button
            class="slds-m-left_small"
            label="Update Salesforce"
            variant="brand"
            onclick={handleUpdateButton}
            disabled={isUpdateDisabled}>
          </lightning-button>
        </div>
      </template>

      <template if:false={hasRows}>
        <p class="slds-p-vertical_medium slds-text-color_weak">No order products found.</p>
      </template>
    </div>

    <template if:true={loading}>
      <lightning-spinner alternative-text="Loading"></lightning-spinner>
    </template>
  </lightning-card>
</template>
